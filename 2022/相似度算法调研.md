## 相似度算法调研



### 前言

相似度算法故名思义，就是判断两个件事物是否是存在相似相似性，通常我们比较多是一些字符串、文本文件。相似度算法其实很多都使用过，很经典的案例毕业论文全网匹配相似度，也就是我们常说的查重。

对两个较短的字符串，我们在人工判断是否具有相似性的时候，通常很快就能做出判断。

For Example:

> 我是中国人，在中国生活！
>
> 我是美国人，在美国生活！



这两个句话，就只存在两个字的差异。大家可以试着想想如何判断这两句是否相似的？

* 首先很容易想到的是统计字符不同个数的数量，在计算不同的字符串在整个字符串的占比，最终得到相似度。

但如果使用统计字符串的方式很容易就在一些特定的语意的情况下很容易产生较大的差异的，比例说：

> 在中国，每一个人爱着国家。
>
> 中秋节，每一个人爱吃月饼。

在这情况下使用统计字符串的方式就可能误报了太大了，但这种情况在本文中不考虑，这属于是自然语言处理的范围，这个领域在全球都是还是一个比较难的研究课题。



---

### 相似度算法介绍

#### 莱文斯坦-编辑距离(Levenshtein)

编辑距离（Minimum Edit Distance，MED），由俄罗斯科学家 Vladimir Levenshtein 在1965年提出，也因此而得名 Levenshtein Distance。

编辑距离的本质思想就是将两个中的一个字符串转化成另一个字符串最少需要编辑单个字符的个数。譬如，"kitten" 和 "sitting" 这两个单词，由 "whoami" 转换为 "whoiam" 需要的最少单字符编辑操作有：

1. whoami → whoimi (substitution of "a" for "i")
2. whoimi → whoiai (substitution of "m" for "a")
3. whoiai → whoiam (substitution of "i"  for "m" at the end)

因此，"whoami"和"whoiam"的编辑距离为3。

表示为 ![lev_{a,b}(|a|, |b|)](https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(%7Ca%7C%2C%20%7Cb%7C))

---

实现算法：

我们将两个字符串![a,b](https://math.jianshu.com/math?formula=a%2Cb)  的 Levenshtein Distance 表示为![lev_{a,b}(|a|, |b|)](https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(%7Ca%7C%2C%20%7Cb%7C)) ，其中![|a|](https://math.jianshu.com/math?formula=|a|) 和 ![|b|](https://math.jianshu.com/math?formula=%7Cb%7C) 分别对应 ![a,b](https://math.jianshu.com/math?formula=a%2Cb) 的长度。那么，在这里两个字符串![a,b](https://math.jianshu.com/math?formula=a%2Cb)   的 Levenshtein Distance，即![lev_{a,b}(|a|, |b|)](https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(%7Ca%7C%2C%20%7Cb%7C))  可用如下的数学语言描述：

![img](https://raw.githubusercontent.com/SummerSec/Images/main/202207/202207081610046)



<p>1. 定义 <img class="math-inline" src="https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(i%2C%20j)" alt="lev_{a,b}(i, j)" mathimg="1"> 指的是 <img class="math-inline" src="https://math.jianshu.com/math?formula=a" alt="a" mathimg="1"> 中<strong>前 <img class="math-inline" src="https://math.jianshu.com/math?formula=i" alt="i" mathimg="1"> 个字符</strong>和 <img class="math-inline" src="https://math.jianshu.com/math?formula=b" alt="b" mathimg="1"> 中<strong>前 <img class="math-inline" src="https://math.jianshu.com/math?formula=j" alt="j" mathimg="1"> 个字符</strong>之间的距离。为了方便理解，这里的<img class="math-inline" src="https://math.jianshu.com/math?formula=i%2Cj" alt="i,j" mathimg="1">可以看作是<img class="math-inline" src="https://math.jianshu.com/math?formula=a%2Cb" alt="a,b" mathimg="1">的长度。这里的字符串的第一个字符 index 从 1 开始（实际因为在表上运算的时候字符串前需要补 0），因此最后的编辑距离便是 <img class="math-inline" src="https://math.jianshu.com/math?formula=i%20%3D%20%7Ca%7C%2C%20j%20%3D%20%7Cb%7C" alt="i = |a|, j = |b|" mathimg="1"> 时的距离：  <img class="math-inline" src="https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(%7Ca%7C%2C%20%7Cb%7C)" alt="lev_{a,b}(|a|, |b|)" mathimg="1"></p>

<p>2. 当 <img class="math-inline" src="https://math.jianshu.com/math?formula=min(i%2C%20j)%20%3D%200" alt="min(i, j) = 0" mathimg="1"> 的时候，对应着字符串<img class="math-inline" src="https://math.jianshu.com/math?formula=a" alt="a" mathimg="1"> 中<strong>前 <img class="math-inline" src="https://math.jianshu.com/math?formula=i" alt="i" mathimg="1"> 个字符</strong>和 字符串<img class="math-inline" src="https://math.jianshu.com/math?formula=b" alt="b" mathimg="1"> 中<strong>前 <img class="math-inline" src="https://math.jianshu.com/math?formula=j" alt="j" mathimg="1"> 个字符</strong>，此时的 <img class="math-inline" src="https://math.jianshu.com/math?formula=i%2Cj" alt="i,j" mathimg="1"> 有一个值为 0 ，表示字符串 a 和 b 中有一个为空串，那么从 a 转换到 b 只需要进行<img class="math-inline" src="https://math.jianshu.com/math?formula=max(i%2C%20j)" alt="max(i, j)" mathimg="1">次单字符编辑操作即可，所以它们之间的编辑距离为 <img class="math-inline" src="https://math.jianshu.com/math?formula=max(i%2C%20j)" alt="max(i, j)" mathimg="1">，即 <img class="math-inline" src="https://math.jianshu.com/math?formula=i%2C%20j" alt="i, j" mathimg="1"> 中的最大者。</p>

<p>3. 当 <img class="math-inline" src="https://math.jianshu.com/math?formula=min(i%2C%20j)%20%5Cne%200" alt="min(i, j) \ne 0" mathimg="1"> 的时候，<img class="math-inline" src="https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(%7Ca%7C%2C%20%7Cb%7C)" alt="lev_{a,b}(|a|, |b|)" mathimg="1"> 为如下三种情况的最小值：<br>
1.<img class="math-inline" src="https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(i-1%2C%20j)%20%2B%201" alt="lev_{a,b}(i-1, j) + 1" mathimg="1"> 表示 删除 <img class="math-inline" src="https://math.jianshu.com/math?formula=a_i" alt="a_i" mathimg="1"><br>
2.<img class="math-inline" src="https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(i%2C%20j-1)%20%2B%201" alt="lev_{a,b}(i, j-1) + 1" mathimg="1"> 表示 插入 <img class="math-inline" src="https://math.jianshu.com/math?formula=b_j" alt="b_j" mathimg="1"><br>
3.<img class="math-inline" src="https://math.jianshu.com/math?formula=lev_%7Ba%2Cb%7D(i-1%2C%20j-1)%2B1_%7B(a_i%20%5Cne%20b_j)%7D" alt="lev_{a,b}(i-1, j-1)+1_{(a_i \ne b_j)}" mathimg="1"> 表示 替换 <img class="math-inline" src="https://math.jianshu.com/math?formula=b_j" alt="b_j" mathimg="1"></p>

<p><img class="math-inline" src="https://math.jianshu.com/math?formula=1_%7B(a_i%20%5Cne%20b_j)%7D" alt="1_{(a_i \ne b_j)}" mathimg="1"> 为一个指示函数，表示当 <img class="math-inline" src="https://math.jianshu.com/math?formula=a_i%20%3D%20b_j" alt="a_i = b_j" mathimg="1"> 的时候取 0 ;当 <img class="math-inline" src="https://math.jianshu.com/math?formula=a_i%20%5Cne%20b_j" alt="a_i \ne b_j" mathimg="1"> 的时候，其值为 1。</p>






---
#### Hamming

两个等长字符串之间的汉明距离是两个字符串对应位置的不同字符的个数。换句话说，它就是将一个字符串变换成另外一个字符串所需要替换的字符个数。例如：

1011101 与 1001001 之间的汉明距离是 2。

2143896 与 2233796 之间的汉明距离是 3。

"toned" 与 "roses" 之间的汉明距离是 3。

最简单汉明算法实现

```go 
func (h *Hamming) CompareUtf8(utf8Str1, utf8Str2 string) float64 {
	count := 0

	l1 := utf8.RuneCountInString(utf8Str1)
	max := l1

	l2 := utf8.RuneCountInString(utf8Str2)
	if max < l2 {
		max = l2
	}

	for i, j := 0, 0; i < len(utf8Str1) && j < len(utf8Str2); {
		size := 0
		r1, size := utf8.DecodeRune(StringToBytes(utf8Str1[i:]))
		i += size

		r2, size := utf8.DecodeRune(StringToBytes(utf8Str2[j:]))
		j += size

		if r1 != r2 {
			count++
		}

	}

	return 1 - (float64(count)+math.Abs(float64(l1-l2)))/float64(max)
}
```

---
#### Dice's coefficient





---
#### Jaro

JaroWinkler

---
#### Cosine



---
#### Simhash




---





---



### 参考



* https://github.com/antlabs/strsim/issues/1
* https://www.jianshu.com/p/a617d20162cf

